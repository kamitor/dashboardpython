<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <Product
      Id="*"
      Name="$(var.AppName)"
      Language="1033"
      Version="$(var.ProductVersion)"
      Manufacturer="Your Company"
      UpgradeCode="6D3AD1B3-A7C3-4807-B844-B615A30E5371">

    <Package
        InstallerVersion="500"
        Compressed="yes"
        InstallScope="perMachine" />

    <MajorUpgrade
        AllowDowngrades="no"
        DowngradeErrorMessage="A newer version of $(var.AppName) is already installed." />

    <MediaTemplate />

    <Feature Id="MainFeature" Title="$(var.AppName)" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>

  </Product>

  <!-- Directory Structure -->
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">

      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="$(var.AppName)" />
      </Directory>

      <Directory Id="ProgramMenuFolder">
        <Directory Id="AppProgramMenuDir" Name="$(var.AppName)" />
      </Directory>

      <Directory Id="DesktopFolder" />

    </Directory>
  </Fragment>

  <!-- Components -->
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">

      <!-- Executable file (per-machine, file KeyPath) -->
      <Component Id="MainExecutableComponent" Guid="*">
        <File
            Id="MainExeFile"
            Source="$(var.SourceExe)"
            KeyPath="yes" />
      </Component>

      <!-- Shortcuts + registry (per-user, HKCU registry KeyPath) -->
      <Component Id="ShortcutsComponent" Guid="*">

        <RegistryValue
            Root="HKCU"
            Key="Software\$(var.AppName)"
            Name="installed"
            Type="integer"
            Value="1"
            KeyPath="yes" />

        <Shortcut
            Id="StartMenuShortcut"
            Directory="AppProgramMenuDir"
            Name="$(var.AppName)"
            WorkingDirectory="INSTALLFOLDER"
            Target="[INSTALLFOLDER]$(var.AppName)-$(var.ProductVersion).exe"
            Advertise="no" />

        <Shortcut
            Id="DesktopShortcut"
            Directory="DesktopFolder"
            Name="$(var.AppName)"
            WorkingDirectory="INSTALLFOLDER"
            Target="[INSTALLFOLDER]$(var.AppName)-$(var.ProductVersion).exe"
            Advertise="no" />

        <RemoveFolder Id="CleanAppProgramMenuDir" Directory="AppProgramMenuDir" On="uninstall" />

      </Component>

    </ComponentGroup>
  </Fragment>

</Wix>
